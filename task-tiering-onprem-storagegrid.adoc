---
sidebar: sidebar 
permalink: task-tiering-onprem-storagegrid.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, storagegrid, tier to storagegrid, fabricpool storagegrid 
summary: 透過將非活動資料分層到NetApp Cloud Tiering中的StorageGRID ，釋放本地ONTAP叢集上的空間。 
---
= 將資料從本地ONTAP叢集分層到NetApp Cloud Tiering中的StorageGRID
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
透過將非活動資料分層到NetApp Cloud Tiering中的StorageGRID ，釋放本地ONTAP叢集上的空間。



== 快速啟動

按照以下步驟快速開始，或向下捲動到其餘部分以獲取完整詳細資訊。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["一"]準備將資料分層到StorageGRID
[role="quick-margin-para"]
您需要以下內容：

[role="quick-margin-list"]
* 已新增至NetApp Console的執行ONTAP 9.4 或更高版本的來源本機ONTAP集群，以及透過使用者指定連接埠到StorageGRID 的連線。 https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["了解如何發現集群"^] 。
* 具有 S3 權限的 AWS 存取金鑰的StorageGRID 10.3 或更高版本。
* 在您的場所安裝控制台代理。
* 代理程式的網路可實現與ONTAP叢集、 StorageGRID和 Cloud Tiering 服務的出站 HTTPS 連線。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["二"]設定分層
[role="quick-margin-para"]
在NetApp Console中，選擇一個本機系統，選擇「啟用」雲端分層，然後依照指示將資料分層到StorageGRID。



== 要求

驗證對ONTAP叢集的支援、設定網路並準備物件儲存。

下圖顯示了每個組件以及您需要在它們之間準備的連接：

image:diagram_cloud_tiering_storagegrid.png["架構圖像顯示了 Cloud Tiering 服務與您本機代理程式的連線、代理程式與您的ONTAP叢集的連線以及ONTAP叢集與物件儲存之間的連線。活動資料駐留在ONTAP叢集上，而非活動資料駐留在物件儲存中。"]


NOTE: 代理程式和StorageGRID之間的通訊僅用於物件儲存設定。



=== 準備ONTAP集群

將資料分層到StorageGRID時，您的ONTAP叢集必須符合以下要求。

支援的ONTAP平台::
+
--
* 使用ONTAP 9.8 及更高版本時：您可以從AFF系統或具有全 SSD 聚合或全 HDD 聚合的FAS系統分層資料。
* 使用ONTAP 9.7 及更早版本時：您可以從AFF系統或具有全 SSD 聚合的FAS系統分層資料。


--
支援的ONTAP版本:: ONTAP 9.4 或更高版本
授權:: 將資料分層到StorageGRID時，您的NetApp Console組織不需要 Cloud Tiering 許可證， ONTAP叢集上也不需要FabricPool許可證。
叢集網路需求::
+
--
* ONTAP叢集透過使用者指定的連接埠啟動與StorageGRID網關節點的 HTTPS 連線（此連接埠可在分層設定期間設定）。
+
ONTAP從物件儲存讀取和寫入資料。物件儲存從不啟動，它只是響應。

* 需要來自代理的入站連接，該代理必須位於您的場所。
+
不需要叢集和 Cloud Tiering 服務之間的連接。

* 每個託管要分層的磁碟區的ONTAP節點上都需要一個叢集間 LIF。  LIF 必須與ONTAP用於連接物件儲存的 _IPspace_ 相關聯。
+
當您設定資料分層時，Cloud Tiering 會提示您使用 IP 空間。您應該選擇與每個 LIF 關聯的 IP 空間。這可能是「預設」 IP 空間或您建立的自訂 IP 空間。詳細了解 https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIF"^]和 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IP空間"^]。



--
支援的捲和聚合:: Cloud Tiering 可以分層的磁碟區總數可能少於ONTAP系統上的磁碟區數。這是因為磁碟區不能從某些聚合中分層。請參閱ONTAP文檔 https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["FabricPool不支援的功能或特性"^]。



NOTE: 從ONTAP 9.5 開始，Cloud Tiering 支援FlexGroup卷。設定方式與任何其他磁碟區相同。



=== 發現ONTAP集群

您需要先將本機ONTAP系統新增至NetApp Console，然後才能開始分層冷資料。

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["了解如何發現集群"^]。



=== 準備StorageGRID

StorageGRID必須符合以下要求。

支援的StorageGRID版本:: 支援StorageGRID 10.3 及更高版本。


[[preparing-storagegrid]]
S3 憑證:: 當您設定分層到StorageGRID時，您需要向 Cloud Tiering 提供 S3 存取金鑰和金鑰。  Cloud Tiering 使用金鑰來存取您的儲存桶。
+
--
這些存取金鑰必須與具有以下權限的使用者相關聯：

[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject",
"s3:CreateBucket"
----
--
物件版本控制:: 您無法在物件儲存桶上啟用StorageGRID物件版本控制。




=== 建立或切換控制台代理

需要控制台代理將資料分層到雲端。將資料分層到StorageGRID時，您的場所必須有代理可用。

您必須具有組織管理員角色才能建立代理程式。

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["了解代理"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-install-connector-on-prem.html["在本地安裝和設定代理"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-manage-multiple-connectors.html#switch-between-connectors["在代理之間切換"^]




=== 為控制台代理準備網絡

確保代理程式具有所需的網路連線。

.步驟
. 確保安裝代理程式的網路啟用以下連線：
+
** 透過連接埠 443 建立到 Cloud Tiering 服務的 HTTPS 連接(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-on-prem.html#endpoints-contacted-for-day-to-day-operations["查看端點列表"^]）
** 透過連接埠 443 建立到StorageGRID系統的 HTTPS 連接
** 透過連接埠 443 建立到ONTAP叢集管理 LIF 的 HTTPS 連接






== 將第一個叢集中的非活動資料分層到StorageGRID

準備好環境後，開始從第一個叢集中分層非活動資料。

.你需要什麼
* https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["新增到NetApp Console的本機系統"^]。
* StorageGRID網關節點的 FQDN 以及將用於 HTTPS 通訊的連接埠。
* 具有所需 S3 權限的 AWS 存取金鑰。


.步驟
. 選擇本地ONTAP系統。
. 點擊右側面板中的“啟用雲端分層”****。
+
如果StorageGRID分層目標是作為NetApp Console中的系統存在，則可以將叢集拖曳到StorageGRID系統上以啟動設定精靈。

+
image:screenshot_setup_tiering_onprem.png["螢幕截圖顯示了選擇本地ONTAP系統後螢幕右側出現的「設定分層」選項。"]

. *定義物件儲存名稱*：輸入此物件儲存的名稱。它必須與您可能在此叢集上與聚合一起使用的任何其他物件儲存不同。
. *選擇提供者*：選擇* StorageGRID*並選擇*繼續*。
. 完成*建立物件儲存*頁面上的步驟：
+
.. *伺服器*：輸入StorageGRID網關節點的 FQDN、 ONTAP應使用 HTTPS 與StorageGRID進行通訊的端口，以及具有所需 S3 權限的帳戶的存取金鑰和金鑰。
.. *Bucket*：新增一個新的 bucket 或選擇一個以前綴 _fabric-pool_ 開頭的現有 bucket，然後選擇 *Continue*。
+
需要 _fabric-pool_ 前綴，因為代理程式的 IAM 策略允許實例對以該精確前綴命名的儲存桶執行 S3 操作。例如，您可以將 S3 儲存桶命名為 _fabric-pool-AFF1_，其中 AFF1 是叢集的名稱。

.. *叢集網路*：選擇ONTAP套用於連接物件儲存的 IP 空間，然後選擇*繼續*。
+
選擇正確的 IP 空間可確保 Cloud Tiering 可以建立從ONTAP到StorageGRID物件儲存的連線。

+
您也可以透過定義「最大傳輸速率」來設定可用於將非活動資料上傳到物件儲存的網路頻寬。選擇*Limited*單選按鈕並輸入可使用的最大頻寬，或選擇*Unlimited*表示沒有限制。



. 在「Tier Volumes」頁面上，選擇要設定分層的磁碟區並啟動「Tiering Policy」頁面：
+
** 若要選取所有捲，請選取標題行中的複選框（image:button_backup_all_volumes.png[""] ) 並選擇 *配置磁碟區*。
** 若要選擇多個卷，請選取每個卷對應的複選框（image:button_backup_1_volume.png[""] ) 並選擇 *配置磁碟區*。
** 若要選擇單一卷，請選擇行（或image:screenshot_edit_icon.gif["編輯鉛筆圖標"]圖示）來表示音量。
+
image:screenshot_tiering_initial_volumes.png["螢幕截圖顯示如何選擇單一磁碟區、多個磁碟區或所有磁碟區以及修改選定磁碟區按鈕。"]



. 在「分層策略」對話方塊中，選擇分層策略，選擇性地調整所選卷的冷卻天數，然後選擇「應用」。
+
link:concept-cloud-tiering.html#volume-tiering-policies["了解有關容量分層策略和冷卻天數的更多信息"]。

+
image:screenshot_tiering_initial_policy_settings.png["顯示可設定分層策略設定的螢幕截圖。"]



.下一步是什麼？
您可以查看有關集群上活動和非活動資料的資訊。link:task-managing-tiering.html["了解有關管理分層設定的更多信息"] 。

如果您希望將資料從叢集上的某些聚合分層到不同的物件存儲，您還可以建立額外的物件儲存。或者，如果您打算使用FabricPool Mirroring，將分層資料複製到其他物件儲存。link:task-managing-object-storage.html["了解有關管理對象存儲的更多信息"] 。
